#include "stm32l476xx.h"
#include "cmsis_gcc.h"
#include "core_cm4.h"
#include "core_cmFunc.h"
#include "core_cmInstr.h"
#include "core_cmSimd.h"
#include "system_stm32l4xx.h"
#define SET_REG(REG, SELECT, VAL) { ((REG)=((REG)&(~(SELECT))) | (VAL)); };
// You can use your way to store TIME_SEC. Maybe it is `int` or `float` or any you want
#define TIME_SEC 12.70


extern void GPIO_init();
extern void max7219_init();
extern void Display();

void InitializeTimer(){
	RCC->APB1ENR1 |= RCC_APB1ENR1_TIM2EN;
	SET_REG(TIM2->CR1, TIM_CR1_DIR, TIM_COUNTERMODE_DOWN);
	TIM2->ARR = (uint32_t) TIM_ARR_VAL;
	TIM2->PSC = (uint32_t) TIME_SEC*(MSI_DEFAULT_FREQ/TIM_ARR_VAL);
	TIM2->EGR = TIM_EGR_UG;
}
void Timer_start(TIM_TypeDef* timer) {

}

int main() {
	GPIO_init();
	max7219_init();
	Timer_init();
	Timer_start();
	while(1) {

	}
}
